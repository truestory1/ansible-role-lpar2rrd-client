---
- name: Prepare RH instances
  hosts: rhel rhel8
  gather_facts: false
  tasks:
    # - name: RHEL base images - install sudo
    #   ansible.builtin.raw: yum -y install shadow-utils passwd util-linux-core util-linux-user sudo

    - name: RH - fix /etc/shadow permissions
      ansible.builtin.raw: chmod 0400 /etc/shadow

- name: Prepare RH8 instances
  hosts: rhel8
  gather_facts: false
  tasks:
    - name: RH8 - install python3.11
      ansible.builtin.raw: yum -y install python3.11 ; alternatives --set python  /usr/bin/python3.11 ; alternatives --set python3  /usr/bin/python3.11

- name: Ensure we all the dependecies
  hosts: all
  gather_facts: true
  tasks:
    - name: Rhel
      when: ansible_facts['distribution'] in ['RedHat']
      block:
        - name: Rhel deps
          ansible.builtin.package:
            name:
              - crontabs
              - cronie
            state: present

        - name: Rhel- start cron service
          ansible.builtin.service:
            name: crond
            enabled: yes
            state: started


    - name: Debian
      when: ansible_facts['distribution'] in ['Debian']
      block:
        - name: Deb deps
          ansible.builtin.apt:
            name:
              - cron
              - procps
            update_cache: yes
            state: present
        - name: Deb - start cron service
          ansible.builtin.service:
            name: cron
            enabled: yes
            state: started
